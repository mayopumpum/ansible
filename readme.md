## Part 1. –£–¥–∞–ª–µ–Ω–Ω–æ–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ —É–∑–ª–∞ —á–µ—Ä–µ–∑ Ansible

1) –°–æ–∑–¥–∞—Ç—å —Å –ø–æ–º–æ—â—å—é Vagrant —Ç—Ä–∏ –º–∞—à–∏–Ω—ã - manager, node01, node02. –ù–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å —Å –ø–æ–º–æ—â—å—é shell-—Å–∫—Ä–∏–ø—Ç–æ–≤ docker –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –º–∞—à–∏–Ω –Ω–∞ Vagrant! –ü—Ä–æ–∫–∏–Ω—É—Ç—å –ø–æ—Ä—Ç—ã node01 –Ω–∞ –ª–æ–∫–∞–ª—å–Ω—É—é –º–∞—à–∏–Ω—É –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –ø–æ–∫–∞ –µ—â–µ –Ω–µ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç–æ–º—É –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–æ–º—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é.

2) –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å manager –∫–∞–∫ —Ä–∞–±–æ—á—É—é —Å—Ç–∞–Ω—Ü–∏—é –¥–ª—è —É–¥–∞–ª–µ–Ω–Ω–æ–≥–æ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä–æ–≤–∞–Ω–∏—è (–ø–æ–º–æ—â—å –ø–æ Ansible –≤ –º–∞—Ç–µ—Ä–∏–∞–ª–∞—Ö).
- –ó–∞–π—Ç–∏ –Ω–∞ manager. 
- –ù–∞ manager –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ node01 —á–µ—Ä–µ–∑ ssh –ø–æ –ø—Ä–∏–≤–∞—Ç–Ω–æ–π —Å–µ—Ç–∏. 
<br/> ![img](images/1.png)
- –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å ssh-–∫–ª—é—á –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ node01 –∏–∑ manager (–±–µ–∑ passphrase).
<br/> ![img](images/2.png)

```
ssh-copy-id -i ~/.ssh/id_rsa.pub 10.11.10.2
```

- –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ manager docker-compose —Ñ–∞–π–ª –∏ –∏—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–æ–≤. (–ò—Å–ø–æ–ª—å–∑—É–π –ø—Ä–æ–µ–∫—Ç –∏–∑ –ø–∞–ø–∫–∏ src –∏ docker-compose —Ñ–∞–π–ª –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–µ–π –≥–ª–∞–≤—ã. –ü–æ–º–æ—â—å –ø–æ ssh –≤ –º–∞—Ç–µ—Ä–∏–∞–ª–∞—Ö.)
- –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Ansible –Ω–∞ –º–µ–Ω–µ–¥–∂–µ—Ä –∏ —Å–æ–∑–¥–∞—Ç—å –ø–∞–ø–∫—É ansible, –≤ –∫–æ—Ç–æ—Ä–æ–π —Å–æ–∑–¥–∞—Ç—å inventory-—Ñ–∞–π–ª.
<br/> ![img](images/4.png)
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–æ–¥—É–ª—å ping –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è —á–µ—Ä–µ–∑ Ansible.
<br/> ![img](images/3.png)


3) –ù–∞–ø–∏—Å–∞—Ç—å –ø–µ—Ä–≤—ã–π –ø–ª–µ–π–±—É–∫ –¥–ª—è Ansible, –∫–æ—Ç–æ—Ä—ã–π –≤—ã–ø–æ–ª–Ω—è–µ—Ç apt update, —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç docker, docker-compose, –∫–æ–ø–∏—Ä—É–µ—Ç compose-—Ñ–∞–π–ª –∏–∑ manager'–∞ –∏ —Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ—Ç –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ.

[__–ü–ª–µ–π–±—É–∫ –¥–ª—è Ansible__](ansible01/services.yml)

–ó–∞–ø—É—Å–∫
<br/> ![img](images/5.png)

4) –ü—Ä–æ–≥–Ω–∞—Ç—å –∑–∞–≥–æ—Ç–æ–≤–ª–µ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã —á–µ—Ä–µ–∑ postman –∏ —É–¥–æ—Å—Ç–æ–≤–µ—Ä–∏—Ç—å—Å—è, —á—Ç–æ –≤—Å–µ –æ–Ω–∏ –ø—Ä–æ—Ö–æ–¥—è—Ç —É—Å–ø–µ—à–Ω–æ. –í –æ—Ç—á–µ—Ç–µ –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.
<br/> ![img](images/6.png)

5) –°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å —Ç—Ä–∏ —Ä–æ–ª–∏: 
 - [__—Ä–æ–ª—å application__](ansible01/roles/application/tasks/main.yml) –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –ø—Ä–∏ –ø–æ–º–æ—â–∏ docker-compose,
 - [__apache__](ansible01/roles/apache/tasks/main.yml) —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π apache —Å–µ—Ä–≤–µ—Ä
 - [__postgres__](ansible01/roles/postgres/tasks/main.yml) —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç postgres, —Å–æ–∑–¥–∞–µ—Ç –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö —Å –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω–æ–π —Ç–∞–±–ª–∏—Ü–µ–π –∏ –¥–æ–±–∞–≤–ª—è–µ—Ç –≤ –Ω–µ–µ —Ç—Ä–∏ –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–µ –∑–∞–ø–∏—Å–∏. 
 - –ù–∞–∑–Ω–∞—á–∏—Ç—å –ø–µ—Ä–≤—É—é —Ä–æ–ª—å node01 –∏ –≤—Ç–æ—Ä—ã–µ –¥–≤–µ —Ä–æ–ª–∏ node02, –ø—Ä–æ–≤–µ—Ä–∏—Ç—å postman-—Ç–µ—Å—Ç–∞–º–∏ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, —É–¥–æ—Å—Ç–æ–≤–µ—Ä–∏—Ç—å—Å—è –≤ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ postgres –∏ apache-—Å–µ—Ä–≤–µ—Ä–∞. –î–ª—è Apache –≤–µ–±-—Å—Ç—Ä–∞–Ω–∏—Ü–∞ –¥–æ–ª–∂–Ω–∞ –æ—Ç–∫—Ä—ã—Ç—å—Å—è –≤ –±—Ä–∞—É–∑–µ—Ä–µ. –ß—Ç–æ –∫–∞—Å–∞–µ—Ç—Å—è PostgreSQL, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è —Å –ª–æ–∫–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω—ã –∏ –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ä–∞–Ω–µ–µ —Å–æ–∑–¥–∞–Ω–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã —Å –¥–∞–Ω–Ω—ã–º–∏.

 [__–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ —Ä–æ–ª–µ–π__](ansible01/all.yml)

–ó–∞–ø—É—Å–∫ ansible-playbook

```ansible-playbook -i nodes.ini all.yml```

<br/> ![img](images/7.png)

–ü—Ä–æ–≤–µ—Ä–∫–∞ apache
<br/> ![img](images/8.png)
<br/> ![img](images/9.png)

–ü—Ä–æ–≤–µ—Ä–∫–∞ postgres
<br/> ![img](images/10.png)

–¢–µ—Å—Ç—ã
<br/> ![img](images/11.png)

6) –°–æ–∑–¥–∞–Ω–Ω—ã–µ –≤ —ç—Ç–æ–º —Ä–∞–∑–¥–µ–ª–µ —Ñ–∞–π–ª—ã —Ä–∞–∑–º–µ—Å—Ç–∏—Ç—å –≤ –ø–∞–ø–∫–µ `src\ansible01` –≤ –ª–∏—á–Ω–æ–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏.

## Part 2. Service Discovery

–¢–µ–ø–µ—Ä—å –ø–µ—Ä–µ–π–¥–µ–º –∫ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—é —Å–µ—Ä–≤–∏—Å–æ–≤. –í —ç—Ç–æ–π –≥–ª–∞–≤–µ —Ç–µ–±–µ –ø—Ä–µ–¥—Å—Ç–æ–∏—Ç c—ã–º–∏—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–≤–∞ —É–¥–∞–ª–µ–Ω–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–∞ - api –∏ –ë–î, –∏ –æ—Å—É—â–µ—Å—Ç–≤–∏—Ç—å –º–µ–∂–¥—É –Ω–∏–º–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Service Discovery —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Consul.

**== –ó–∞–¥–∞–Ω–∏–µ ==**

1) –ù–∞–ø–∏—Å–∞—Ç—å –¥–≤–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ñ–∞–π–ª–∞ –¥–ª—è consul (–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –ø–æ consul –≤ –º–∞—Ç–µ—Ä–∏–∞–ª–∞—Ö):
- consul_server.hcl:
   - –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–≥–µ–Ω—Ç –∫–∞–∫ —Å–µ—Ä–≤–µ—Ä;
   - —É–∫–∞–∑–∞—Ç—å –≤ advertise_addr –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å, –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π –≤–æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω—é—é —Å–µ—Ç—å Vagrant
- consul_client.hcl:
   - –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–≥–µ–Ω—Ç –∫–∞–∫ –∫–ª–∏–µ–Ω—Ç;
   - —É–∫–∞–∑–∞—Ç—å –≤ advertise_addr –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å, –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π –≤–æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω—é—é —Å–µ—Ç—å Vagrant


2) –°–æ–∑–¥–∞—Ç—å —Å –ø–æ–º–æ—â—å—é Vagrant —Ç—Ä–∏ –º–∞—à–∏–Ω—ã - consul_server, api –∏ db. 
- –ü—Ä–æ–∫–∏–Ω—É—Ç—å –ø–æ—Ä—Ç 8082 —Å api –Ω–∞ –ª–æ–∫–∞–ª—å–Ω—É—é –º–∞—à–∏–Ω—É –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –ø–æ–∫–∞ –µ—â–µ –Ω–µ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç–æ–º—É api
- –ü—Ä–æ–∫–∏–Ω—É—Ç—å –ø–æ—Ä—Ç 8500 —Å manager –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ ui consul. 

3) –ù–∞–ø–∏—Å–∞—Ç—å –ø–ª–µ–π–±—É–∫ –¥–ª—è ansible –∏ —á–µ—Ç—ã—Ä–µ —Ä–æ–ª–∏: 
- install_consul_server, –∫–æ—Ç–æ—Ä–∞—è:
   - —Ä–∞–±–æ—Ç–∞–µ—Ç —Å consul_server;
   - –∫–æ–ø–∏—Ä—É–µ—Ç consul_server.hcl;
   - —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç consul –∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–ª—è consul –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏;
   - –∑–∞–ø—É—Å–∫–∞–µ—Ç —Å–µ—Ä–≤–∏—Å consul
- install_consul_client, –∫–æ—Ç–æ—Ä–∞—è:
   - —Ä–∞–±–æ—Ç–∞–µ—Ç —Å api –∏ db;
   - –∫–æ–ø–∏—Ä—É–µ—Ç consul_client.hcl;
   - —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç consul, envoy –∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–ª—è consul –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏; 
   - –∑–∞–ø—É—Å–∫–∞–µ—Ç —Å–µ—Ä–≤–∏—Å consul –∏ consul-envoy;
- install_db, –∫–æ—Ç–æ—Ä–∞—è:
   - —Ä–∞–±–æ—Ç–∞–µ—Ç —Å db;
   - —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç postgres –∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç –µ–≥–æ;
   - —Å–æ–∑–¥–∞–µ—Ç –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö `hotels_db`;
- install_hotels_service, –∫–æ—Ç–æ—Ä–∞—è:
   - —Ä–∞–±–æ—Ç–∞–µ—Ç —Å api;
   - –∫–æ–ø–∏—Ä—É–µ—Ç –∏—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ —Å–µ—Ä–≤–∏—Å–∞
   - —É—Å—Ç–∞–Ω–∞–≤–ª–≤–∏–∞–µ—Ç `openjdk-8-jdk`
   - —Å–æ–∑–¥–∞–µ—Ç –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:
      - POSTGRES_HOST="127.0.0.1"
      - POSTGRES_PORT="5432"
      - POSTGRES_DB="hotels_db"
      - POSTGRES_USER="<–∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è>"
      - POSTGRES_PASSWORD="<–ø–∞—Ä–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è>"
   - –∑–∞–ø—É—Å–∫–∞–µ—Ç —Å–æ–±—Ä–∞–Ω–Ω—ã–π jar-—Ñ–∞–π–ª –∫–æ–º–∞–Ω–¥–æ–π `java -jar <–ø—É—Ç—å –¥–æ hotel-service>/hotel-service/target/<–∏–º—è jar-—Ñ–∞–π–ª–∞>.jar`

4) –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å CRUD-–æ–ø–µ—Ä–∞—Ü–∏–π –Ω–∞–¥ —Å–µ—Ä–≤–∏—Å–æ–º –æ—Ç–µ–ª–µ–π. –í –æ—Ç—á–µ—Ç–µ –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.

5) –°–æ–∑–¥–∞–Ω–Ω—ã–µ –≤ —ç—Ç–æ–º —Ä–∞–∑–¥–µ–ª–µ —Ñ–∞–π–ª—ã —Ä–∞–∑–º–µ—Å—Ç–∏—Ç—å –≤ –ø–∞–ø–∫–∞—Ö `src\ansible02` –∏ `src\consul01` –≤ –ª–∏—á–Ω–æ–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏.

üí° [–ù–∞–∂–º–∏ —Å—é–¥–∞](https://forms.yandex.ru/cloud/6475b9e02530c22269917318/), **—á—Ç–æ–±—ã –ø–æ–¥–µ–ª–∏—Ç—å—Å—è —Å –Ω–∞–º–∏ –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑—å—é –Ω–∞ —ç—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç**. –≠—Ç–æ –∞–Ω–æ–Ω–∏–º–Ω–æ –∏ –ø–æ–º–æ–∂–µ—Ç –∫–æ–º–∞–Ω–¥–µ –ü—Ä–æ–¥—É–∫—Ç–∞ —Å–¥–µ–ª–∞—Ç—å —Ç–≤–æ—ë –æ–±—É—á–µ–Ω–∏–µ –ª—É—á—à–µ.
